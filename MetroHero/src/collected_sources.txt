=== Source Collection Start ===

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\main.c
[FILE NAME] main.c
------------------------------------------------------------

#include <windows.h>
#include "core/game.h"
#include "debug/debug.h"  // â˜… ì¶”ê°€

int main(void) {

    // debug_console_info();

    game_run();
    return 0;
}


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\core\combat.c
[FILE NAME] combat.c
------------------------------------------------------------

// core/combat.c
#include "combat.h"
#include "ui.h"
#include "../world/map.h"
#include <stdio.h>

// â˜… ì¸ì ‘ ì  ì²´í¬ ë° ë©”ì‹œì§€ ìë™ ìƒì„±
void combat_check_nearby_enemy(Map* m, Player* p) {
    Enemy* nearEnemy = map_get_adjacent_enemy(m, p->x, p->y);

    if (nearEnemy != NULL) {
        const char* direction = map_get_enemy_direction(m, p->x, p->y, nearEnemy);
        char logMsg[128];
        snprintf(logMsg, sizeof(logMsg), "%sì— %sì´(ê°€) ì„œìˆë‹¤!", direction, nearEnemy->name);
        ui_add_log(logMsg);
    }
}

// â˜… ë‚˜ì¤‘ì— ì „íˆ¬ ì‹œìŠ¤í…œ ì¶”ê°€
void combat_attack_enemy(Player* p, Enemy* e) {
    // ë°ë¯¸ì§€ ê³„ì‚°
    int damage = p->attack - e->defense;
    if (damage < 0) damage = 0;

    e->hp -= damage;

    // ì „íˆ¬ ë¡œê·¸
    char logMsg[128];
    snprintf(logMsg, sizeof(logMsg), "%së¥¼ ê³µê²©! %d ë°ë¯¸ì§€!", e->name, damage);
    ui_add_log(logMsg);

    if (e->hp <= 0) {
        e->isAlive = 0;
        snprintf(logMsg, sizeof(logMsg), "%së¥¼ ì²˜ì¹˜í–ˆë‹¤!", e->name);
        ui_add_log(logMsg);
    }
    else {
        // ì  ë°˜ê²©
        int enemyDamage = e->attack - p->defense;
        if (enemyDamage < 0) enemyDamage = 0;

        p->hp -= enemyDamage;
        snprintf(logMsg, sizeof(logMsg), "%sì˜ ë°˜ê²©! %d ë°ë¯¸ì§€!", e->name, enemyDamage);
        ui_add_log(logMsg);
    }
}

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\core\combat.h
[FILE NAME] combat.h
------------------------------------------------------------

#pragma once
// core/combat.h
#ifndef COMBAT_H
#define COMBAT_H

#include "../entity/player.h"
#include "../entity/enemy.h"
#include "../world/map.h"

// ì¸ì ‘ ì  ì²´í¬ ë° ë©”ì‹œì§€ ìƒì„±
void combat_check_nearby_enemy(Map* m , Player* p);

// ì „íˆ¬ ì‹œì‘ (ë‚˜ì¤‘ì— êµ¬í˜„)
void combat_attack_enemy(Player* p , Enemy* e);

#endif

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\core\game.c
[FILE NAME] game.c
------------------------------------------------------------

#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <stdlib.h>
#include <conio.h>   // _getch
#include <ctype.h>   // tolower
#include "game.h"
#include "ui.h"
#include "../world/map.h"
#include "../entity/player.h"
#include "../world/glyph.h"  // â˜… ì¶”ê°€
#include "combat.h"  // â˜… ì¶”ê°€

void game_run(void) {
    Map map;
    Player player;
    int prevX, prevY;  // â˜… ì´ì „ ìœ„ì¹˜ ì €ì¥

    map_init(&map, 1);
    player_init(&player);

    // â˜… ìŠ¤í° í¬ì¸íŠ¸ì— í”Œë ˆì´ì–´ ë°°ì¹˜
    player.x = map.spawnX;
    player.y = map.spawnY;

    ui_init();


    // â˜… ì´ˆê¸° í™”ë©´ì€ í•œ ë²ˆë§Œ ê·¸ë¦¬ê¸°
    console_clear_fast();
    map_draw_at(&map, &player, 0, 0);

    // â˜… ìƒíƒœì°½ (ìƒë‹¨)
    ui_draw_stats(&player, EQ_X, 0, EQ_W, 10);

    // â˜… ì¥ë¹„ì°½ (ì¤‘ê°„)
    ui_draw_equipment(&player, EQ_X, 10, EQ_W, 6);
    ui_draw_log(0, LOG_Y, LOG_W, LOG_H);

    // â˜… ì…ë ¥ ì•ˆë‚´ëŠ” ì´ˆê¸°ì— í•œ ë²ˆë§Œ ì¶œë ¥ (ë¡œê·¸ì°½ ë°–)
    console_goto(0, SCREEN_H - 1);
    printf("[í™”ì‚´í‘œ/WASD] ì´ë™ | [Q] ì¢…ë£Œ");

    prevX = player.x;
    prevY = player.y;

    while (1) {
        int cmd = _getch();

        // â˜… í™”ì‚´í‘œ í‚¤ ì²˜ë¦¬ (2ë°”ì´íŠ¸ ì…ë ¥)
        if (cmd == 0 || cmd == 224) {  // íŠ¹ìˆ˜ í‚¤ ê°ì§€
            cmd = _getch();  // ì‹¤ì œ í‚¤ ì½”ë“œ ì½ê¸°

            switch (cmd) {
            case 72: cmd = 'w'; break;  // ìœ„ìª½ í™”ì‚´í‘œ
            case 80: cmd = 's'; break;  // ì•„ë˜ìª½ í™”ì‚´í‘œ
            case 75: cmd = 'a'; break;  // ì™¼ìª½ í™”ì‚´í‘œ
            case 77: cmd = 'd'; break;  // ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ
            }
        }

        cmd = tolower(cmd);

        if (cmd == 'q') break;

        player_move(&player, &map, cmd);

        if (prevX != player.x || prevY != player.y) {
            // ì´ì „ ìœ„ì¹˜ë¥¼ ì›ë˜ íƒ€ì¼ë¡œ ë³µì›
            console_goto(prevX * 2, prevY);

            // â˜… map.cì˜ tile_to_glyphë¥¼ publicìœ¼ë¡œ ë§Œë“¤ê³  ì¬ì‚¬ìš©
            extern const char* tile_to_glyph(char t);  // map.hì— ì„ ì–¸ ì¶”ê°€
            printf("%s", tile_to_glyph(map.tiles[prevY][prevX]));

            // ìƒˆ ìœ„ì¹˜ ê·¸ë¦¬ê¸°
            console_goto(player.x * 2, player.y);
            printf(GLYPH_PLAYER);

            // â˜… ê°„ë‹¨í•˜ê²Œ í•œ ì¤„ë¡œ!
            combat_check_nearby_enemy(&map, &player);

            // â˜… ë¡œê·¸ì°½ ê°±ì‹  ì¶”ê°€
            ui_draw_log(0, LOG_Y, LOG_W, LOG_H);

            // â˜… ì…ë ¥ ì•ˆë‚´ ë‹¤ì‹œ ì¶œë ¥ (ë¡œê·¸ê°€ ë®ì–´ì“¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
            //console_goto(0, SCREEN_H - 1);
            //printf("[w,a,s,d] ì´ë™ | [q] ì¢…ë£Œ");

            prevX = player.x;
            prevY = player.y;
        }
    }
}


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\core\game.h
[FILE NAME] game.h
------------------------------------------------------------

#ifndef GAME_H
#define GAME_H

void game_run(void);

#endif


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\core\ui.c
[FILE NAME] ui.c
------------------------------------------------------------

#include <windows.h>
#include <stdio.h>
#include "ui.h"
#include "../entity/player.h"

void ui_init(void) {

    HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);

    // ì½˜ì†”ì„ UTF-8ë¡œ ì„¤ì •
    SetConsoleOutputCP(CP_UTF8);
    SetConsoleCP(CP_UTF8);

    // â˜… ìˆœì„œ ì¤‘ìš”: ë¨¼ì € ìœˆë„ìš° í¬ê¸°ë¥¼ ìµœì†Œë¡œ ì¤„ì„
    //SMALL_RECT minWindow = { 0, 0, 1, 1 };
    //SetConsoleWindowInfo(hOut, TRUE, &minWindow);

    //// â˜… ê·¸ ë‹¤ìŒ ë²„í¼ í¬ê¸° ì„¤ì •
    //COORD bufferSize = { SCREEN_W, SCREEN_H };
    //SetConsoleScreenBufferSize(hOut, bufferSize);

    //// â˜… ë§ˆì§€ë§‰ìœ¼ë¡œ ìœˆë„ìš° í¬ê¸°ë¥¼ ì›í•˜ëŠ” í¬ê¸°ë¡œ ì„¤ì •
    //SMALL_RECT windowSize = { 0, 0, SCREEN_W - 1, SCREEN_H - 1 };
    //SetConsoleWindowInfo(hOut, TRUE, &windowSize);

    // ì»¤ì„œ ìˆ¨ê¸°ê¸°(ì„ íƒ)
    CONSOLE_CURSOR_INFO info;
    info.dwSize = 1;
    info.bVisible = FALSE;
    SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &info);
}

//void console_clear_fast(void) {
//    HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
//    COORD pos = { 0, 0 };
//    SetConsoleCursorPosition(hOut, pos);
//}

void console_clear_fast(void) {
    HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);

    CONSOLE_SCREEN_BUFFER_INFO csbi;
    GetConsoleScreenBufferInfo(hOut, &csbi);

    DWORD cellCount = csbi.dwSize.X * csbi.dwSize.Y;
    DWORD count;
    COORD homeCoords = { 0, 0 };

    // í™”ë©´ ì „ì²´ë¥¼ ê³µë°±ìœ¼ë¡œ ì±„ìš°ê¸°
    FillConsoleOutputCharacter(hOut, ' ', cellCount, homeCoords, &count);

    // í™”ë©´ ì†ì„± ë¦¬ì…‹
    FillConsoleOutputAttribute(hOut, csbi.wAttributes, cellCount, homeCoords, &count);

    // ì»¤ì„œ ìœ„ì¹˜ ë¦¬ì…‹
    SetConsoleCursorPosition(hOut, homeCoords);
}


void console_goto(int x, int y) {
    COORD pos = { x, y };
    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);
}


// í™”ë©´ì— í‘œì‹œë˜ëŠ” ì‹¤ì œ í­ ê³„ì‚° (í•œê¸€ = 2ì¹¸, ì˜ë¬¸ = 1ì¹¸)
int display_width(const char* str) { // publicìœ¼ë¡œ ìˆ˜ì •
    int width = 0;
    const unsigned char* s = (const unsigned char*)str;

    while (*s) {
        if (*s < 128) {
            // ASCII (1ë°”ì´íŠ¸) = 1ì¹¸
            width += 1;
            s += 1;
        }
        else if ((*s & 0xE0) == 0xC0) {
            // UTF-8 2ë°”ì´íŠ¸ ë¬¸ì = 2ì¹¸
            width += 2;
            s += 2;
        }
        else if ((*s & 0xF0) == 0xE0) {
            // UTF-8 3ë°”ì´íŠ¸ ë¬¸ì (í•œê¸€ ë“±) = 2ì¹¸
            width += 2;
            s += 3;
        }
        else if ((*s & 0xF8) == 0xF0) {
            // UTF-8 4ë°”ì´íŠ¸ ë¬¸ì = 2ì¹¸
            width += 2;
            s += 4;
        }
        else {
            s += 1;
        }
    }
    return width;
}

// ui.cì— ì¶”ê°€

void ui_draw_stats(const Player* p, int x, int y, int w, int h) {
    console_goto(x, y);
    printf("â”Œâ”€ ìƒíƒœ      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");

    console_goto(x, y + 1);
    printf("â”‚                      â”‚");

    // HP ë°” ê·¸ë¦¬ê¸° - ì •í™•í•˜ê²Œ ë§ì¶”ê¸°
    console_goto(x, y + 2);
    printf("â”‚ HP:");  // 'HP:' ê¹Œì§€ ì¶œë ¥

    // HP ë°” (10ì¹¸)
    int hpBars = (p->hp * 10) / p->maxHp;
    for (int i = 0; i < 10; i++) {
        if (i < hpBars)
            printf("â–ˆ");
        else
            printf("â–‘");
    }
    printf("        â”‚");  // â˜… ê³µë°± 7ê°œ

    // HP ìˆ˜ì¹˜
    console_goto(x, y + 3);
    printf("â”‚     %3d / %3d        â”‚", p->hp, p->maxHp);

    console_goto(x, y + 4);
    printf("â”‚                      â”‚");

    // ê³µê²©ë ¥
    console_goto(x, y + 5);
    printf("â”‚ ê³µê²©ë ¥:  %3d         â”‚", p->attack);

    // ë°©ì–´ë ¥
    console_goto(x, y + 6);
    printf("â”‚ ë°©ì–´ë ¥:  %3d         â”‚", p->defense);

    // ë‚˜ë¨¸ì§€ ë¹ˆ ê³µê°„
    for (int i = 7; i < h - 1; i++) {
        console_goto(x, y + i);
        printf("â”‚                      â”‚");
    }

    console_goto(x, y + h - 1);
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
}

// ui_draw_equipment ìˆ˜ì • (ë†’ì´ ì¡°ì •)
void ui_draw_equipment(const Player* p, int x, int y, int w, int h) {
    console_goto(x, y);
    printf("â”Œâ”€ ì¥ë¹„      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");

    console_goto(x, y + 1);
    printf("â”‚                      â”‚");

    console_goto(x, y + 2);
    printf("â”‚ ë¬´ê¸°:    %s", p->weaponName);
    int len = display_width(p->weaponName);
    for (int i = 0; i < 11 - len; i++) putchar(' ');
    printf(" â”‚");

    console_goto(x, y + 3);
    printf("â”‚ ë°©ì–´êµ¬:  %s", p->armorName);
    len = display_width(p->armorName);
    for (int i = 0; i < 11 - len; i++) putchar(' ');
    printf(" â”‚");

    console_goto(x, y + 4);
    printf("â”‚ ì•„ì´í…œ : %s", p->item1);
    len = display_width(p->item1);
    for (int i = 0; i < 11 - len; i++) putchar(' ');
    printf(" â”‚");

    console_goto(x, y + 5);
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
}

#define LOG_LINES 200
char log_buf[LOG_LINES][128];
int log_index = 0;

void ui_add_log(const char* msg) {
    snprintf(log_buf[log_index], 128, "%s", msg);
    log_index = (log_index + 1) % LOG_LINES;
}

void ui_draw_log(int x, int y, int w, int h) {
    // ìƒë‹¨ í…Œë‘ë¦¬
    console_goto(x, y);
    printf("â”Œâ”€ ëŒ€í™”  ");
    for (int i = 8; i < w - 2; i++) printf("â”€");
    printf("â”");

    int start = (log_index - (h - 2) + LOG_LINES) % LOG_LINES;

    // ë¡œê·¸ ë‚´ìš©
    for (int i = 0; i < h - 2; i++) {
        console_goto(x, y + 1 + i);
        printf("â”‚ ");

        const char* logText = log_buf[(start + i) % LOG_LINES];
        printf("%s", logText);

        // â˜… í™”ë©´ í‘œì‹œ í­ ì •í™•íˆ ê³„ì‚°
        int displayLen = display_width(logText);
        int contentWidth = w - 4;  // "â”‚ " + " â”‚" = 4ì¹¸
        int remaining = contentWidth - displayLen;

        // â˜… ë‚¨ì€ ê³µê°„ì„ ê³µë°±ìœ¼ë¡œ ì±„ìš°ê¸°
        for (int j = 0; j < remaining; j++) {
            printf(" ");
        }

        printf(" â”‚");
    }

    // í•˜ë‹¨ í…Œë‘ë¦¬
    console_goto(x, y + h - 1);
    printf("â””");
    for (int i = 1; i < w - 1; i++) printf("â”€");
    printf("â”˜");
}



------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\core\ui.h
[FILE NAME] ui.h
------------------------------------------------------------

#ifndef UI_H
#define UI_H

#include "../entity/player.h"

#define SCREEN_W 120
#define SCREEN_H 30

// ìƒë‹¨ ì „ì²´ ë†’ì´
#define TOP_H 20

// ë§µ ì„¤ì •
//#define MAP_W 40                // ë…¼ë¦¬ì  ê°€ë¡œ ì¹¸ ìˆ˜
//#define MAP_H 20                // ë§µ ì„¸ë¡œ ìˆ˜
//#define MAP_RENDER_W (MAP_W*2)  // ì‹¤ì œ ì¶œë ¥ë˜ëŠ” ë¬¸ì í­ 80

// â˜… ë§µ ë Œë”ë§ ìµœëŒ€ ë„ˆë¹„ (ë™ì  í¬ê¸° ì§€ì›)
#define MAX_MAP_RENDER_W 100  // ìµœëŒ€ê°’ë§Œ ì •ì˜

// ì¥ë¹„ì°½(ì˜¤ë¥¸ìª½) - ê³ ì • ìœ„ì¹˜
#define EQ_X 80       // â˜… ê³ ì •ê°’ìœ¼ë¡œ ë³€ê²½ (MAX_MAP_W * 2)
#define EQ_W (SCREEN_W - EQ_X)
#define EQ_H TOP_H

// ë¡œê·¸ì°½(í•˜ë‹¨)
#define LOG_Y TOP_H
#define LOG_W SCREEN_W
#define LOG_H (SCREEN_H - TOP_H -1)


void console_goto(int x , int y);

void ui_draw_equipment(const Player* p , int x , int y , int w , int h);  // â˜… ì´ ì¤„ í™•ì¸
void ui_draw_stats(const Player* p , int x , int y , int w , int h);  // â˜… ì¶”ê°€


void ui_add_log(const char* msg);
void ui_draw_log(int x , int y , int w , int h);

void console_clear_fast(void);

#endif


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\debug\debug.c
[FILE NAME] debug.c
------------------------------------------------------------

#include <windows.h>
#include <stdio.h>
#include <conio.h>
#include "debug.h"

void debug_console_info(void) {
    HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);

    // â˜… UTF-8 ì„¤ì • ë¨¼ì €!
    SetConsoleOutputCP(CP_UTF8);
    SetConsoleCP(CP_UTF8);

    CONSOLE_SCREEN_BUFFER_INFO csbi;
    GetConsoleScreenBufferInfo(hOut, &csbi);

    printf("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘     ì½˜ì†” ìƒíƒœ ë””ë²„ê¹… ì •ë³´          â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");

    printf("ë²„í¼ í¬ê¸°:   %d x %d\n", csbi.dwSize.X, csbi.dwSize.Y);
    printf("ìœˆë„ìš° í¬ê¸°: %d x %d\n",
        csbi.srWindow.Right - csbi.srWindow.Left + 1,
        csbi.srWindow.Bottom - csbi.srWindow.Top + 1);
    printf("ì»¤ì„œ ìœ„ì¹˜:   (%d, %d)\n",
        csbi.dwCursorPosition.X, csbi.dwCursorPosition.Y);
    printf("\nìœˆë„ìš° ì¢Œí‘œ:\n");
    printf("  Left=%d, Top=%d\n", csbi.srWindow.Left, csbi.srWindow.Top);
    printf("  Right=%d, Bottom=%d\n", csbi.srWindow.Right, csbi.srWindow.Bottom);

    printf("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    printf("ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ë©´ ê³„ì†...");
    _getch();
    printf("\n");
}

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\debug\debug.h
[FILE NAME] debug.h
------------------------------------------------------------

#pragma once
#ifndef DEBUG_H
#define DEBUG_H

// ì½˜ì†” ìƒíƒœ ì •ë³´ ì¶œë ¥
void debug_console_info(void);

// ê²Œì„ ìƒíƒœ ì •ë³´ ì¶œë ¥ (ë‚˜ì¤‘ì— ì¶”ê°€ ê°€ëŠ¥)
// void debug_game_state(void);
// void debug_player_info(const Player* p);

#endif

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\entity\enemy.c
[FILE NAME] enemy.c
------------------------------------------------------------

#include "enemy.h"
#include <stdio.h>

void enemy_init(Enemy* e, char type, int x, int y) {
    e->type = type;
    e->x = x;
    e->y = y;
    e->isAlive = 1;

    // íƒ€ì…ë³„ ìŠ¤íƒ¯ ì„¤ì •
    switch (type) {
    case 'a':  // ê³ ë¸”ë¦°
        e->name = "ê³ ë¸”ë¦°";
        e->maxHp = 5;
        e->hp = 5;
        e->attack = 2;
        e->defense = 0;
        break;

    case 'b':  // ì˜¤í¬ (ë‚˜ì¤‘ì— ì¶”ê°€)
        e->name = "ì˜¤í¬";
        e->maxHp = 10;
        e->hp = 10;
        e->attack = 3;
        e->defense = 1;
        break;

    default:  // ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì…
        e->name = "ëª¬ìŠ¤í„°";
        e->maxHp = 3;
        e->hp = 3;
        e->attack = 1;
        e->defense = 0;
        break;
    }
}

int enemy_is_at(const Enemy* e, int x, int y) {
    return (e->isAlive && e->x == x && e->y == y);
}

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\entity\enemy.h
[FILE NAME] enemy.h
------------------------------------------------------------

#ifndef ENEMY_H
#define ENEMY_H

#define MAX_ENEMIES 50  // ë§µë‹¹ ìµœëŒ€ ì  ìˆ˜

typedef struct {
	int x , y;           // ìœ„ì¹˜
	char type;          // 'a' = ê³ ë¸”ë¦°, 'b' = ì˜¤í¬ ë“±
	int hp;
	int maxHp;
	int attack;
	int defense;
	int isAlive;        // 1 = ì‚´ì•„ìˆìŒ, 0 = ì£½ìŒ
	const char* name;   // "ê³ ë¸”ë¦°", "ì˜¤í¬" ë“±
} Enemy;

// ì  ì´ˆê¸°í™” (íƒ€ì…ì— ë”°ë¼ ìŠ¤íƒ¯ ì„¤ì •)
void enemy_init(Enemy* e , char type , int x , int y);

// ì ì´ í•´ë‹¹ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸
int enemy_is_at(const Enemy* e , int x , int y);

#endif#pragma once


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\entity\player.c
[FILE NAME] player.c
------------------------------------------------------------

#include <stdio.h>

#include "../world/map.h"
#include "player.h"
#include "../core/ui.h"  // â˜… ui_add_log ì‚¬ìš©ì„ ìœ„í•´ ì¶”ê°€

void player_init(Player* p) {
    // â˜… ë§µ í¬ê¸°ë¥¼ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’ ì„¤ì •
    p->x = 20;  // ë˜ëŠ” map_init í›„ì— ì„¤ì •
    p->y = 10;

    // â˜… ì´ˆê¸° ìŠ¤íƒ¯
    p->maxHp = 10;
    p->hp = 10;
    p->attack = 1;
    p->defense = 0;

    p->weaponName = "";
    p->armorName = "";
    p->item1 = "";
}


void player_move(Player* p, const Map* m, int cmd) {
    int nx = p->x;
    int ny = p->y;

    switch (cmd) {
    case 'w': ny--; break;
    case 's': ny++; break;
    case 'a': nx--; break;
    case 'd': nx++; break;
    }

    if (map_is_walkable(m, nx, ny)) {
        p->x = nx;
        p->y = ny;

        // ì´ë™ ì„±ê³µ ë¡œê·¸ ì°ê¸°
        //char logMsg[128];
        //snprintf(logMsg, sizeof(logMsg), "ì´ë™: (%d, %d)", p->x, p->y);
		//ui_add_log(logMsg);
    }
}


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\entity\player.h
[FILE NAME] player.h
------------------------------------------------------------

#ifndef PLAYER_H
#define PLAYER_H

struct Map; // Map êµ¬ì¡°ì²´ì˜ ì „ë°© ì„ ì–¸

typedef struct {
	int x, y;

	// â˜… ìŠ¤íƒ¯
	int hp;           // í˜„ì¬ ì²´ë ¥
	int maxHp;        // ìµœëŒ€ ì²´ë ¥
	int attack;       // ê³µê²©ë ¥
	int defense;      // ë°©ì–´ë ¥

	const char* weaponName;
	const char* armorName;
	const char* item1;
} Player;

void player_init(Player* p);
void player_move(Player* p, const struct Map* m, int cmd); // struct Map*ë¡œ ëª…í™•íˆ ì„ ì–¸

#endif


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\world\glyph.h
[FILE NAME] glyph.h
------------------------------------------------------------

#ifndef GLYPH_H
#define GLYPH_H

// ========================
// ë Œë”ë§ ë¬¸ì ìƒìˆ˜ ì •ì˜
// ========================

// ë§µ íƒ€ì¼
#define GLYPH_FLOOR    "  "    // ë°”ë‹¥
#define GLYPH_WALL     "â–ˆâ–ˆ"    // ë²½
#define GLYPH_RAIL     "=="    // ì² ë„ ë ˆì¼
#define GLYPH_EMPTY    "  "    // ë¹ˆ ê³µê°„
#define GLYPH_DOOR     "++"    // ë¬¸
#define GLYPH_STAIRS   "â–¼â–¼"    // ê³„ë‹¨

// ì—”í‹°í‹°
#define GLYPH_PLAYER   "ì˜·"    // í”Œë ˆì´ì–´
#define GLYPH_DOG      "ğŸˆâ€"    // â˜… ê³ ë¸”ë¦° ì¶”ê°€
#define GLYPH_ORC      "ì˜¤"    // ë‚˜ì¤‘ì— ì‚¬ìš©
#define GLYPH_NPC      "ë¯¼"    // NPC
#define GLYPH_ITEM     "ë¬¼"    // ì•„ì´í…œ

// ê¸°íƒ€
#define GLYPH_TREE     "â™£â™£"    // ë‚˜ë¬´
#define GLYPH_WATER    "â‰ˆâ‰ˆ"    // ë¬¼

// ========================
// íƒ€ì¼ ë¬¸ì (ë§µ ë°ì´í„°ìš©)
// ========================
#define TILE_FLOOR     '.'
#define TILE_WALL      '#'
#define TILE_RAIL      '='
#define TILE_DOOR      '+'
#define TILE_SPAWN     '@'     // â˜… ìŠ¤í° í¬ì¸íŠ¸

// â˜… ì  íƒ€ì¼
#define TILE_GOBLIN    'a'
#define TILE_ORC       'b'

#endif

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\world\map.c
[FILE NAME] map.c
------------------------------------------------------------

#include <stdio.h>
#include <windows.h>
#include "map.h"
#include "../entity/player.h"
#include "../entity/enemy.h"  // â˜… ì¶”ê°€
#include "../core/ui.h"   // â˜… ë°˜ë“œì‹œ í•„ìš”
#include "map_data.h"  // â˜… ì¶”ê°€
#include "glyph.h"  // â˜… ì¶”ê°€

// íƒ€ì¼ ë¬¸ìë¥¼ ë Œë”ë§ ë¬¸ìë¡œ ë³€í™˜
const char* tile_to_glyph(char t) {
    switch (t) {
    case '.':
        return GLYPH_FLOOR;
    case '#':
        return GLYPH_WALL;
    case '=':
        return GLYPH_RAIL;
    case '+':
        return GLYPH_DOOR;
    case 'S':
        return GLYPH_STAIRS;
    default:
        return GLYPH_EMPTY;
    }
}

// â˜… ì  íƒ€ì¼ì„ ë Œë”ë§ ë¬¸ìë¡œ ë³€í™˜
const char* enemy_to_glyph(char type) {
    switch (type) {
    case 'a':
        return GLYPH_DOG;
    case 'b':
        return GLYPH_ORC;
    default:
        return "??";
    }
}

// â˜… ìŠ¤í° í¬ì¸íŠ¸ ì°¾ê¸°
void map_find_spawn(Map* m) {
    // ê¸°ë³¸ê°’ (ì¤‘ì•™)
    m->spawnX = m->width / 2;
    m->spawnY = m->height / 2;

    // @ ì°¾ê¸°
    for (int y = 0; y < m->height; y++) {
        for (int x = 0; x < m->width; x++) {
            if (m->tiles[y][x] == '@') {
                m->spawnX = x;
                m->spawnY = y;
                // @ ë¥¼ ì¼ë°˜ ë°”ë‹¥ìœ¼ë¡œ ë³€í™˜
                m->tiles[y][x] = '.';
                return;  // ì²« ë²ˆì§¸ @ ë§Œ ì‚¬ìš©
            }
        }
    }
}

// â˜… ë§µì—ì„œ ì  ì°¾ì•„ì„œ ì´ˆê¸°í™”
void map_load_enemies(Map* m) {
    m->enemyCount = 0;

    for (int y = 0; y < m->height; y++) {
        for (int x = 0; x < m->width; x++) {
            char tile = m->tiles[y][x];

            // a~z ë²”ìœ„ì˜ ì  íƒ€ì¼ ì°¾ê¸°
            if (tile >= 'a' && tile <= 'z') {
                if (m->enemyCount < MAX_ENEMIES) {
                    enemy_init(&m->enemies[m->enemyCount], tile, x, y);
                    m->enemyCount++;

                    // ì ì´ ìˆë˜ ìë¦¬ëŠ” ë°”ë‹¥ìœ¼ë¡œ ë³€ê²½
                    m->tiles[y][x] = '.';
                }
            }
        }
    }
}

// â˜… íŠ¹ì • ìœ„ì¹˜ì— ìˆëŠ” ì  ë°˜í™˜
Enemy* map_get_enemy_at(Map* m, int x, int y) {
    for (int i = 0; i < m->enemyCount; i++) {
        if (enemy_is_at(&m->enemies[i], x, y)) {
            return &m->enemies[i];
        }
    }
    return NULL;
}


// -------------------------------
// ë§µ ì´ˆê¸°í™”
// -------------------------------
void map_init(Map* m, int stageNumber) {
    m->stageNumber = stageNumber;  // â˜… ì„ íƒì‚¬í•­
    load_map(m, stageNumber);
    map_find_spawn(m);  // â˜… ì´ ì¤„ ì¶”ê°€!
    map_load_enemies(m);  // â˜… ì´ ì¤„ ì¶”ê°€!
}

// -------------------------------
// ë§µ ë Œë”ë§
// -------------------------------
//void map_draw(const Map* m, const Player* p) {
//    for (int y = 0; y < MAP_H; y++) {
//        for (int x = 0; x < MAP_W; x++) {
//
//            if (p->x == x && p->y == y) {
//                // í”Œë ˆì´ì–´ ìœ„ì¹˜
//                printf(">>");   // ì „ê° í”Œë ˆì´ì–´ ì•„ì´ì½˜
//            }
//            else {
//                printf("%s", tile_to_glyph(m->tiles[y][x]));
//            }
//
//        }
//        putchar('\n');
//    }
//}

void map_draw_at(const Map* m, const Player* p, int startX, int startY) {
    for (int y = 0; y < m->height; y++) {
        console_goto(startX, startY + y);

        for (int x = 0; x < m->width; x++) {
            if (x == p->x && y == p->y) {
                // í”Œë ˆì´ì–´
                printf(GLYPH_PLAYER);
            }
            else {
                // â˜… ì ì´ ìˆëŠ”ì§€ í™•ì¸
                Enemy* enemy = map_get_enemy_at((Map*)m, x, y);
                if (enemy != NULL) {
                    printf("%s", enemy_to_glyph(enemy->type));
                }
                else {
                    printf("%s", tile_to_glyph(m->tiles[y][x]));
                }
            }
        }
    }
}





int map_is_walkable(const Map* m, int x, int y) {
    if (x < 0 || x >= m->width || y < 0 || y >= m->height)
        return 0;

    // â˜… ì ì´ ìˆìœ¼ë©´ ì´ë™ ë¶ˆê°€ (ë‚˜ì¤‘ì— ì „íˆ¬ë¡œ ë³€ê²½)
    Enemy* enemy = map_get_enemy_at((Map*)m, x, y);
    if (enemy != NULL) {
        return 0;  // ì¼ë‹¨ ì´ë™ ë¶ˆê°€
    }

    return (m->tiles[y][x] == '.');
}


// â˜… í”Œë ˆì´ì–´ ì£¼ë³€(ìƒí•˜ì¢Œìš°)ì— ì ì´ ìˆëŠ”ì§€ í™•ì¸
Enemy* map_get_adjacent_enemy(Map* m, int px, int py) {
    // ìƒí•˜ì¢Œìš° 4ë°©í–¥ ì²´í¬
    int directions[4][2] = {
        {0, -1},  // ìœ„
        {0, 1},   // ì•„ë˜
        {-1, 0},  // ì™¼ìª½
        {1, 0}    // ì˜¤ë¥¸ìª½
    };

    for (int i = 0; i < 4; i++) {
        int nx = px + directions[i][0];
        int ny = py + directions[i][1];

        Enemy* enemy = map_get_enemy_at(m, nx, ny);
        if (enemy != NULL) {
            return enemy;
        }
    }

    return NULL;
}

// â˜… ì ì´ ì–´ëŠ ë°©í–¥ì— ìˆëŠ”ì§€ ë°˜í™˜
const char* map_get_enemy_direction(Map* m, int px, int py, Enemy* enemy) {
    if (enemy->x < px) return "ì™¼ìª½";
    if (enemy->x > px) return "ì˜¤ë¥¸ìª½";
    if (enemy->y < py) return "ìœ„";
    if (enemy->y > py) return "ì•„ë˜";
    return "ì—¬ê¸°";
}

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\world\map.h
[FILE NAME] map.h
------------------------------------------------------------

#ifndef MAP_HEADER
#define MAP_HEADER

#include "../entity/player.h"
#include "../entity/enemy.h"  // â˜… ì¶”ê°€

#define MAX_MAP_W 100  // ìµœëŒ€ í¬ê¸°ë§Œ ì •ì˜
#define MAX_MAP_H 50

//#define MAP_W 40
//#define MAP_H 20

//typedef struct {
//    char tiles[MAP_H][MAP_W];
//} Map;

typedef struct {
	int width;
	int height;
	int stageNumber;  // â˜… í˜„ì¬ ìŠ¤í…Œì´ì§€ ë²ˆí˜¸ ì¶”ê°€ (ì„ íƒì‚¬í•­)
	int spawnX;  // â˜… ìŠ¤í° ìœ„ì¹˜ ì¶”ê°€
	int spawnY;  // â˜… ìŠ¤í° ìœ„ì¹˜ ì¶”ê°€
	char tiles[ MAX_MAP_H ][ MAX_MAP_W ];

	// â˜… ì  ê´€ë¦¬
	Enemy enemies[ MAX_ENEMIES ];
	int enemyCount;
} Map;

void map_init(Map* m , int stageNumber);  // â˜… ì¸ì ì¶”ê°€
void map_draw_at(const Map* m , const Player* p , int startX , int startY);
int map_is_walkable(const Map* m, int x, int y);
const char* tile_to_glyph(char t);  // â˜… ì¶”ê°€
void map_find_spawn(Map* m);  // â˜… ì¶”ê°€
void map_load_enemies(Map* m);  // â˜… ì¶”ê°€
Enemy* map_get_enemy_at(Map* m , int x , int y);  // â˜… ì¶”ê°€
Enemy* map_get_adjacent_enemy(Map* m , int px , int py);  // â˜… ì¶”ê°€
const char* map_get_enemy_direction(Map* m , int px , int py , Enemy* enemy);  // â˜… ì¶”ê°€


#endif


------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\world\map_data.c
[FILE NAME] map_data.c
------------------------------------------------------------

#include "map_data.h"
#include <string.h>

// ========================
// ë§µ ë°ì´í„° ì •ì˜ (ìƒë‹¨ì— ëª¨ì•„ë‘ê¸°)
// ========================

static const char* MAP_STAGE_1[] = {
    "########################################",
    "#@....##################...............#",
    "#.....#.........a......................#",
    "#.....#.####...........#########.......#",
    "#.....#.#..#...........#.......#.......#",
    "#.......#..#############.......#.......#",
    "#.......#..................#####.......#",
    "#########..................#...........#",
    "#.........................##...........#",
    "#.......#####..........#####...........#",
    "#.......#...#..........#...............#",
    "#.......#...############...............#",
    "#.......#..............................#",
    "#.......#############..................#",
    "#.....................#................#",
    "#.....................#................#",
    "#.....................##################",
    "#......................................#",
    "#......................................#",
    "########################################"
};

static const char* MAP_STAGE_2[] = {
    "########################################",
    "#====================================..#",
    "#====================================..#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "#......................................#",
    "########################################"
};

static const char* MAP_STAGE_3[] = {
    "####################",
    "#..................#",
    "#....####..........#",
    "#....#..#..........#",
    "#....####..........#",
    "#..................#",
    "#..................#",
    "#..................#",
    "#..................#",
    "####################"
};

static const char* MAP_DEFAULT[] = {
    "####################",
    "#..................#",
    "#..................#",
    "#..................#",
    "#..................#",
    "#..................#",
    "#..................#",
    "#..................#",
    "#..................#",
    "####################"
};

// ========================
// ë¡œì§ í•¨ìˆ˜ë“¤
// ========================

// â˜… ê³µí†µ ë¡œë“œ í•¨ìˆ˜
static void load_map_from_data(Map* m, const char** mapData, int height) {
    m->height = height;
    m->width = strlen(mapData[0]);

    for (int y = 0; y < m->height; y++) {
        for (int x = 0; x < m->width && x < MAX_MAP_W; x++) {
            m->tiles[y][x] = mapData[y][x];
        }
    }
}

// â˜… ìŠ¤í…Œì´ì§€ ë²ˆí˜¸ë¡œ ë§µ ë¡œë“œ
void load_map(Map* m, int stageNumber) {
    switch (stageNumber) {
    case 1:
        load_map_from_data(m, MAP_STAGE_1, sizeof(MAP_STAGE_1) / sizeof(MAP_STAGE_1[0]));
        break;
    case 2:
        load_map_from_data(m, MAP_STAGE_2, sizeof(MAP_STAGE_2) / sizeof(MAP_STAGE_2[0]));
        break;
    case 3:
        load_map_from_data(m, MAP_STAGE_3, sizeof(MAP_STAGE_3) / sizeof(MAP_STAGE_3[0]));
        break;
    default:
        load_map_from_data(m, MAP_DEFAULT, sizeof(MAP_DEFAULT) / sizeof(MAP_DEFAULT[0]));
        break;
    }
}

------------------------------------------------------------
[FILE PATH] C:\projects\MetroHero\MetroHero\src\world\map_data.h
[FILE NAME] map_data.h
------------------------------------------------------------

#ifndef MAP_DATA_H
#define MAP_DATA_H

#include "map.h"

// â˜… ë‹¨ì¼ í•¨ìˆ˜ë¡œ ë³€ê²½
void load_map(Map* m , int stageNumber);

#endif

=== Source Collection End ===
